
#lang at-exp racket/base

(require ming ming/list
         racket/format
         "gua-helper.rkt"
         "8gua.rkt"
         "64gua.rkt")
(provide 天价地量? 天量地价? 高价缩量? 低价起量? 低价低量? 超量超价?
         get-days 卦象解析 量价解析)

;; (名 (今日买卖点 data)
;;     (名 data0 (􏾛 data))
;;     (名 d0 (􏷜 data))
;;     (名 d1 (􏷛 data))
;;     (名 d2 (􏷚 data))
;;     (名 datan3 (d0 d1 d2))
;;     )

;; (名 (持续跃迁? d0 d1 d2)
;;     (名 n1
;;         (􏷑􏺗 (入 (d) (􏿰弔 'jgua-n d)) (􏿴 d0 d1 d2)))
;;     (名 n2
;;         (􏷑􏺘 (入 (d) (􏿰弔 'jgua-n d)) (􏿴 d0 d1 d2)))
;;     (丫 (> (- n1 n2) 1)
;;         #t
;;         #f)
;;     )

;; (名 (当日活跃? d0 d1 d2)
;;     (if (> (􏿰弔 d0 'lgua-n) 4)
;;         #t
;;         #f))

;; (名 (买入? d0 d1 d2)
;;     (if (< (􏿰弔 d0 'jgua-n) 3)
;;         #t
;;         #f))

;; (名 (卖出? d0 d1 d2)
;;     (if (> (􏿰弔 d0 'jgua-n) 5)
;;         #t
;;         #f))

(名 (超量超价? d)
    (并 (> (􏿰弔 d 'jgua-n) 5)
        (> (􏿰弔 d 'lgua-n) 5)))

(名 (天价地量? d)
    (并 (> (􏿰弔 d 'jgua-n) 5)
        (< (􏿰弔 d 'lgua-n) 2)))

(名 (天量地价? d)
    (并 (< (􏿰弔 d 'jgua-n) 2)
        (> (􏿰弔 d 'lgua-n) 5)))

(名 (高价缩量? d)
    (并 (> (􏿰弔 d 'jgua-n) 5)
        (并 (> (􏿰弔 d 'lgua-n) 2)
            (< (􏿰弔 d 'lgua-n) 5))))

(名 (低价起量? d)
    (并 (> (􏿰弔 d 'jgua-n) 5)
        (并 (> (􏿰弔 d 'lgua-n) 2)
            (< (􏿰弔 d 'lgua-n) 5))))

(名 (低价低量? d)
    (并 (< (􏿰弔 d 'jgua-n) 2)
        (< (􏿰弔 d 'lgua-n) 2)))

(名 (买入信号? dn) ; 连续三日低价起量
    (􏷐 低价起量? dn))

(名 (卖出信号? dn) ; 连续三日高价缩量
    (􏷐 高价缩量? dn))

(名 (超买信号? d)
    (天量地价? d))

(名 (风险信号? d)
    (天价地量? d))

(名 (get-days proced dn)
    (􏷑  (lambda (d) (􏿰弔 d 'day))
        (􏹈 proced dn)))

(名 (卦象解析 复卦)
    @~a{最近一个交易日卦象（复卦）为: @|复卦|，序号为：@(弓 六十四卦 复卦)。拆解后，其上单卦（量卦）为： @(上单卦 复卦)，序号是：@(弓 八卦 (上单卦 复卦))；其下单卦（价卦）为： @(下单卦 复卦)，序号是：@(弓 八卦 (下单卦 复卦))。})

(名 (量价解析 d)
    (名 (置 data key)
        (肖 (􏿰弔 data key)
            [(5 6 7) "高"]
            [(3 4) "中"]
            [(0 1 2) "低"]
            [夬 #f]))
    (名 (风险 d)
        (当
         [(超量超价? d) "风险提示：超量超价(多方买入)。"]
         [(天量地价? d) "买入信号：天量地价(超强买入)，可以入场。"]
         [(天价地量? d) "风险提示：天价地量，需密切关注，如已购入，建议减仓。"]
         [(高价缩量? d) "卖出信号：高价缩量(卖出信号)。"]
         [(低价起量? d) "买入信号：低价起量(一般买入)。"]
         [(低价低量? d) "观望市场：低价低量(市场低靡), 不建议操作。"]

         [夬 "无异常，观望市场。"])
        )
    @~a{@(􏿰弔 d 'day)当日，本股交易量位于@(置 d 'lgua-n)位，价格位于@(置 d 'jgua-n)位。@(风险 d)})
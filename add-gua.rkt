#lang racket/base

(require ming
         ming/number
         "8gua.rkt"
         "64gua.rkt"
         "conv-gua.rkt"
         )

(provide 攸以价卦
         攸以量卦
         攸以复卦)


(名 (攸以价卦 H 顶价 底价)
    (名 间价
        (/ (- 顶价 底价) 64))
    (名 卦序价 ;由低到高
        (􏼎 64 (λ (N)
                 (+ 底价 (* 间价 (􏽊 N))))))
    (名 均价
        (/ (+ (句化米 (􏿰弔 H 'low))
              (句化米 (􏿰弔 H 'high))) 2))
    (名 价卦
        (弔 六十四卦 (􏹂 卦序价 (λ (价) (>= 价 均价)))))
    (􏿰攸+ H
      'avg-price 均价
      'price-gua 价卦)
    )

(名 (攸以量卦 H 顶量 底量)
    (名 间量
        (/ (- 顶量 底量) 64))
    (名 卦序量  ;由低到高
        (􏼎 64 (λ (N)
                (+ 底量 (* 间量 (􏽊 N))))))
    (名 实量 (句化米 (􏿰弔 H 'volume)))
    (名 量卦
        (弔 六十四卦 (􏹂 卦序量 (λ (量) (>= 量 实量)))))
    (􏿰攸 H 'volume-gua 量卦)
    )



(名 (攸以复卦 H)
    (名 上卦 (下单卦 (􏿰弔 H 'volume-gua)))
    (名 下卦 (下单卦 (􏿰弔 H 'price-gua)))
    (名 卦 (复卦 上卦 下卦))
    (􏿰攸+ H 'gua 卦)
    )

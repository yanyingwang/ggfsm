#lang racket/base

(require ming
         ming/number
         "8gua.rkt"
         )

(provide 攸以价卦
         攸以量卦)


(名 (攸以价卦 H 顶价 底价)
    ;均价是平均数，总是低于顶价的
    ;(> 价 均价) 保证了低于最低价的平均价总是乾卦
    (名 间价
        (􏹔 (/ (- 顶价 底价) 7)))
    (名 八卦价序 ;由低到高
        (􏿴  (- 顶价 (* 间价 7))
             (- 顶价 (* 间价 6))
             (- 顶价 (* 间价 5))
             (- 顶价 (* 间价 4))
             (- 顶价 (* 间价 3))
             (- 顶价 (* 间价 2))
             (- 顶价 (* 间价 1))
             (- 顶价 (* 间价 0))))
    (名 均价
        (/ (+ (句化米 (􏿰弔 H 'low))
              (句化米 (􏿰弔 H 'high))) 2))
    (名 价卦 (弔 八卦 (􏹂 八卦价序 (λ (价) (>= 价 均价)))))
    (􏿰攸+ H
      'avg-price 均价
      'price-gua 价卦)
    )


(名 (攸以量卦 H 顶量 底量)
    (名 间量
        (􏹓 (/ (- 顶量 底量) 7)))
    (名 八卦量序  ;由低到高
        (􏿴  (- 顶量 (* 间量 7))
             (- 顶量 (* 间量 6))
             (- 顶量 (* 间量 5))
             (- 顶量 (* 间量 4))
             (- 顶量 (* 间量 3))
             (- 顶量 (* 间量 2))
             (- 顶量 (* 间量 1))
             (- 顶量 (* 间量 0))))
    (名 实量 (句化米 (􏿰弔 H 'volume)))
    (名 量卦
        (弔 八卦 (􏹂 八卦量序  (λ (量) (>= 量 实量)))))
    (􏿰攸 H 'volume-gua 量卦)
    )
